# SQLとSASの関係

SASはデータベース製品が非常に高価だった時にはデータベースとしての利用例もあったということもあり、最近ではあまり使われない機能も多いですが、データベースの機能の多くを持っています。またSASで扱うようなデータの多くはデータベースを使用して収集されています。

SASではドライバーのインストールなどにより、データベース製品に接続して操作することも可能ですが、一般的にはデータステップに近い形でデータの抽出や加工などに使われます。  

その際には`proc sql` と `proc fedsql` の2種類のプロシージャが利用可能です。

## SQLを使うメリットとデメリット

**メリット**

- 生成系AI等によるアシストを受けやすい
- ケースにより効率的に処理を記述できることがある

**デメリット**

- データステップに加えて覚える必要がある
- SASのバージョンが古いとパフォーマンスが悪化する場合がある
- サブクエリの使い方で可読性が落ちることがある

## **proc sql** と **proc fedsqlの違い**

PROC FEDSQLはPROC SQLを置き換えるために作成されたわけではなく、PROC SQLができなかった、またはうまく実行できなかったタスクを実行するために作成されたものです。そのためproc sqlのコードがそのままではうまく動かないケースも多いので注意が必要です。

**proc sql** 

以前からSASに組み込まれており、SAS関数やデータセットオプションも利用できるため、SASでのSALのほとんどの場合で利用されている

**proc fedsql** 

ANSI SQL 1999標準に準拠していることからSQL文の互換性が高いが、SAS関数やデータセットオプションは利用できない。パフォーマンスが高くデータベースに接続する場合や比較的新しい環境やプロシージャと相性が良い


SASで利用する場合は基本的にproc sqlの方を利用することが多く、以降でも特に言及しない場合はproc sqlと考えてください。 

## SQLとデータステップ

複数のステップを使用すれば、どちらかにしかできない操作はほとんどありません。

一般に比較的単純な操作ではどちらも同じか、若干SQLのほうが有利なケースがありますが、細かい・複雑な操作が必要になる場合はデータステップが有利です。

### プロシージャの呼び出し

SASでは`proc sql`または`proc fedsql`から実行します。テーブル名の部分はデータステップと同様にライブラリ+データセット名で指定します。
対話的なプロシージャなので複数のSQL文をひとつのプロシージャ内で実行することができ、プロシージャの最後は`run`ではなく、`quit`とします。SQL文の末尾には「;」が必要です。

```jsx
proc sql ;
  /* SQL文1 ; */
quit ;

proc sql noprint ;
  /* SQL文1 ; */
  /* SQL文2 ; */
quit ;
```

以降では特に説明がなければSQL文のみを記載します。実行は基本的にproc sqlからを意図していますが、データを用意しテーブル名を調整してもらえば他の言語で行っても構いません。SQLの句は大文字で書かれることも多く、またここでは目立たせたいため大文字で記載します。  
選択されたレコードがある場合には、outputにproc printのように出力されます。データセットを作成する場合には出力は不要なことがほとんどと思うので、その場合は「noprint」オプションを記載します。